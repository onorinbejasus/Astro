// Generated by CoffeeScript 1.3.2
var Projection,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Projection = (function() {

  function Projection() {
    this.imageToMap = __bind(this.imageToMap, this);

    this.getHeader = __bind(this.getHeader, this);
    this.parameters = null;
    this.getHeader("./images/testframe.jpeg");
    this.imageToMap(499, 499);
  }

  Projection.prototype.getHeader = function(image) {
    var _this = this;
    this.parameters = new Object;
    $.ajaxSetup({
      'async': false
    });
    $.getJSON("./imageHeader.php?url=" + image, function(data) {
      return $.each(data, function(key, val) {
        if (key === "CRVAL_1") {
          _this.parameters.crval1 = val;
        }
        if (key === "CRVAL_2") {
          _this.parameters.crval2 = val;
        }
        if (key === "CRPIX_1") {
          _this.parameters.crpix1 = val;
        }
        if (key === "CRPIX_2") {
          _this.parameters.crpix2 = val;
        }
        if (key === "CD1_1") {
          _this.parameters.cd11 = val;
        }
        if (key === "CD1_2") {
          _this.parameters.cd12 = val;
        }
        if (key === "CD2_1") {
          _this.parameters.cd21 = val;
        }
        if (key === "CD2_2") {
          return _this.parameters.cd22 = val;
        }
      });
    });
    $.ajaxSetup({
      'async': true
    });
  };

  Projection.prototype.imageToMap = function(xsize, ysize) {
    var i, j, lat, long, x, xpix, y, ypix, _i, _j, _k, _l, _m, _n, _o, _p, _ref, _results, _results1, _results2, _results3, _results4, _results5, _results6, _results7;
    xpix = (function() {
      _results = [];
      for (var _i = 0; 0 <= xsize ? _i <= xsize : _i >= xsize; 0 <= xsize ? _i++ : _i--){ _results.push(_i); }
      return _results;
    }).apply(this);
    ypix = (function() {
      _results1 = [];
      for (var _j = 0; 0 <= ysize ? _j <= ysize : _j >= ysize; 0 <= ysize ? _j++ : _j--){ _results1.push(_j); }
      return _results1;
    }).apply(this);
    x = (function() {
      _results2 = [];
      for (var _k = 0; 0 <= xsize ? _k <= xsize : _k >= xsize; 0 <= xsize ? _k++ : _k--){ _results2.push(_k); }
      return _results2;
    }).apply(this);
    y = (function() {
      _results3 = [];
      for (var _l = 0; 0 <= ysize ? _l <= ysize : _l >= ysize; 0 <= ysize ? _l++ : _l--){ _results3.push(_l); }
      return _results3;
    }).apply(this);
    long = (function() {
      _results4 = [];
      for (var _m = 0, _ref = Math.max(xsize, ysize); 0 <= _ref ? _m <= _ref : _m >= _ref; 0 <= _ref ? _m++ : _m--){ _results4.push(_m); }
      return _results4;
    }).apply(this);
    lat = (function() {
      _results5 = [];
      for (var _n = 0; 0 <= xsize ? _n <= xsize : _n >= xsize; 0 <= xsize ? _n++ : _n--){ _results5.push(_n); }
      return _results5;
    }).apply(this);
    _results6 = [];
    for (i = _o = 0; 0 <= xsize ? _o <= xsize : _o >= xsize; i = 0 <= xsize ? ++_o : --_o) {
      lat[i] = (function() {
        _results7 = [];
        for (var _p = 0; 0 <= ysize ? _p <= ysize : _p >= ysize; 0 <= ysize ? _p++ : _p--){ _results7.push(_p); }
        return _results7;
      }).apply(this);
      _results6.push((function() {
        var _q, _results8;
        _results8 = [];
        for (j = _q = 0; 0 <= ysize ? _q <= ysize : _q >= ysize; j = 0 <= ysize ? ++_q : --_q) {
          x[i] = this.parameters.cd11 * (xpix[i] - this.parameters.crpix1) + this.parameters.cd12 * (ypix[j] - this.parameters.crpix2);
          y[i] = this.parameters.cd21 * (xpix[i] - this.parameters.crpix1) + this.parameters.cd22 * (ypix[j] - this.parameters.crpix2);
          long[i] = Math.atan2(-y[i], x[i]);
          lat[i][j] = Math.PI / 2.0;
          _results8.push(console.log(lat[i][j]));
        }
        return _results8;
      }).call(this));
    }
    return _results6;
  };

  return Projection;

})();
